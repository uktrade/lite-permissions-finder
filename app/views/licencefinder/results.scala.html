@import controllers.licencefinder.ResultsController
@import util._
@import views.html.common.page._
@import views.html.common.form._
@import models.view.licencefinder.ResultsView
@import views.html.frontendComponents.formRadioWithDetailPanel

@this(standardPage: standardPage)
@(form: Form[_], resultsView: ResultsView, sessionId: String)

@chosenOgelFormField = @{"chosenOgel"}

@ogelLabel(alreadyRegistered: Boolean, ogelName: String) = {
  @if(alreadyRegistered) {
    <span class="bold">You have already registered for this OGEL:</span><br>
  }
  OGEL (@ogelName)
}

@standardPage(resultsView.getTitle(), Some(heading(resultsView.getTitle()))){
  @errorSummary(form)
}{

  <form action="@controllers.licencefinder.routes.ResultsController.handleResultsSubmit(sessionId)" method="POST">

    @views.html.helper.CSRF.formField

    @if(resultsView.hasOgels()) {
      <p>
        Open licences allow you to export certain goods without making a new application each time you export them.
      </p>

      @formRadioGroupContainer(form(chosenOgelFormField))(Html("Select the option which best matches your requirements."), "p", "") {
        @for(ogelView <- resultsView.getOgelViews()) {
          @formRadioWithDetailPanel(form("chosenOgel"), ogelLabel(ogelView.getAlreadyRegistered, ogelView.getName).toString, ogelView.getId, true, detailPanelId = ogelView.getId + "detailPanel", detailPanelPrompt = "More information") {
            @ogelView.getUsageSummary().iterator().next()
          }
        }

        <p class="form-block">or</p>
        @formRadio(form("chosenOgel"), "None of the above applies fully to my situation", ResultsController.NONE_ABOVE_KEY, true)
      }

      <div class="form-group">
        <button type="submit" class="button">Continue</button>
      </div>
    } else {
      <p>
        Your goods cannot be exported via an open licence. We will need to know more about the goods you want to export.
      </p>
      <p>
        Please <a href="http://www.spire.trade.gov.uk/" rel="external" target="_blank">log in to Spire<span class="visually-hidden"> (opens in a new tab)</span></a>  to continue..
      </p>
    }

  </form>
}