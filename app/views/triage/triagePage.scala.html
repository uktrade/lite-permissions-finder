@import com.google.common.collect.Iterables
@import models.view.BreadcrumbView
@import views.html.util._
@import views.html.frontendComponents.controlCodeBreadcrumbs._
@import views.html.common.page._
@import views.html.common.state._
@import play.twirl.api.HtmlFormat

@(form: Form[_], stageId: String, sessionId: String, resumeCode: String, title: String, breadcrumbView: BreadcrumbView)(secondaryHeading: Html)(formContent: Html)

@standardPage(title, None, twoThirdsColumn = false, resumeCode = resumeCode){
}{
  @twoThirdsColumn{
    @errorSummary(form)
  }

  <div class="grid-row">
    <div class="column-two-thirds">

      <header class="page-header">
        <h1 class="heading-large">
          @if(secondaryHeading.body.trim.nonEmpty) {
            <span class="heading-secondary">
            @secondaryHeading
            </span>
          }
          @title
        </h1>
      </header>

      <form action="@routes.StageController.handleSubmit(stageId,sessionId)" method="POST">
        @contextFormParams()
        @formContent

        <button type="submit" class="button" name="action" value="continue">Save and continue</button>
        <button type="submit" class="button secondary" name="action" value="none" data-skip-validation>None of the above</button>

      </form>
    </div>
    <div class="column-one-third">
      <h2 class="heading-medium">You are here</h2>
      @controlCodeBreadcrumbs(){
        @for((breadcrumbItemView, index) <- breadcrumbView.getBreadcrumbItemViews.zipWithIndex) {
          @if(index == breadcrumbView.getBreadcrumbItemViews.size - 1) {
            @controlCodeBreadcrumbsDetailBox(isPathStep = true, changeUrl = breadcrumbItemView.getUrl){
              @if(breadcrumbItemView.getText!=null) {
                <span class="bold">@breadcrumbItemView.getText</span>
              }
              @if(breadcrumbItemView.getDescription!=null) {
                @Html(breadcrumbItemView.getDescription)
              }
              @if(breadcrumbView.isDecontrol) {
                <p>
                  Checking against decontrols
                </p>
              }
            }{
              @if(!breadcrumbView.getNoteViews.isEmpty) {
                @controlCodeBreadcrumbsNotes() {
                  @for(noteView <- breadcrumbView.getNoteViews) {
                    <li>@Html(noteView.getText)</li>
                  }
                }
              } else {
                @HtmlFormat.empty
              }
            }
          } else {
            @controlCodeBreadcrumbsStep(breadcrumbItemView.getUrl){
              @if(breadcrumbItemView.getText!=null) {
                <span class="bold">@breadcrumbItemView.getText</span>
              }
              @if(breadcrumbItemView.getDescription!=null) {
                @Html(breadcrumbItemView.getDescription)
              }
            }
          }
        }
      }
    </div>
  </div>
}
